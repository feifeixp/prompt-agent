# æ¡ˆä¾‹åº“åå°ç®¡ç†ç³»ç»Ÿ

## ğŸ¯ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯ (React)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ç”¨æˆ·ç•Œé¢    â”‚  â”‚  ç®¡ç†åå°    â”‚  â”‚  API å®¢æˆ·ç«¯  â”‚  â”‚
â”‚  â”‚  (App.jsx)   â”‚  â”‚(AdminPanel)  â”‚  â”‚ (cases.js)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“ HTTP/HTTPS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Cloudflare Worker (_worker.js)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  é™æ€èµ„æº    â”‚  â”‚  API è·¯ç”±    â”‚  â”‚  è®¤è¯ä¸­é—´ä»¶  â”‚  â”‚
â”‚  â”‚  æœåŠ¡        â”‚  â”‚  å¤„ç†        â”‚  â”‚  (JWT)       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Cloudflare D1 æ•°æ®åº“                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  cases       â”‚  â”‚  case_tags   â”‚  â”‚ case_media   â”‚  â”‚
â”‚  â”‚  (æ¡ˆä¾‹è¡¨)    â”‚  â”‚  (æ ‡ç­¾è¡¨)    â”‚  â”‚ (åª’ä½“è¡¨)     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ æ–‡ä»¶ç»“æ„

```
prompt-agent/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ cases.js              # API å®¢æˆ·ç«¯å°è£…
â”‚   â”‚   â””â”€â”€ admin-routes.js       # åç«¯è·¯ç”±é€»è¾‘ï¼ˆå‚è€ƒï¼‰
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ AdminPanel.jsx        # ç®¡ç†åå°ç•Œé¢
â”‚   â”‚   â”œâ”€â”€ CasesTab.jsx          # æ¡ˆä¾‹å±•ç¤ºé¡µé¢
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ Router.jsx                # ç®€å•è·¯ç”±ï¼ˆ/ å’Œ /adminï¼‰
â”‚   â””â”€â”€ main.jsx                  # åº”ç”¨å…¥å£
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ import-cases.js           # æ•°æ®å¯¼å…¥è„šæœ¬
â”œâ”€â”€ _worker.js                    # Cloudflare Worker ä¸»æ–‡ä»¶
â”œâ”€â”€ schema.sql                    # æ•°æ®åº“è¡¨ç»“æ„
â”œâ”€â”€ wrangler.jsonc                # Cloudflare é…ç½®
â”œâ”€â”€ ADMIN_SETUP.md                # éƒ¨ç½²æŒ‡å—
â””â”€â”€ BACKEND_README.md             # æœ¬æ–‡ä»¶
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
npm install
```

### 2. åˆ›å»ºæ•°æ®åº“

```bash
# åˆ›å»º D1 æ•°æ®åº“
wrangler d1 create prompt-agent-db

# è®°å½•è¿”å›çš„ database_idï¼Œæ›´æ–°åˆ° wrangler.jsonc
```

### 3. åˆå§‹åŒ–æ•°æ®åº“

```bash
# æ‰§è¡Œ SQL è„šæœ¬
wrangler d1 execute prompt-agent-db --file=./schema.sql
```

### 4. æœ¬åœ°å¼€å‘

```bash
# å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨
npm run dev

# è®¿é—® http://localhost:5173 æŸ¥çœ‹ç”¨æˆ·ç•Œé¢
# è®¿é—® http://localhost:5173/admin æŸ¥çœ‹ç®¡ç†åå°
```

### 5. éƒ¨ç½²

```bash
# æ„å»ºé¡¹ç›®
npm run build

# éƒ¨ç½²åˆ° Cloudflare
wrangler deploy
```

## ğŸ” è®¤è¯ç³»ç»Ÿ

### JWT Token è®¤è¯

ç³»ç»Ÿä½¿ç”¨ JWT (JSON Web Token) è¿›è¡Œèº«ä»½éªŒè¯ï¼š

1. **ç™»å½•æµç¨‹**ï¼š
   - ç”¨æˆ·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
   - åç«¯éªŒè¯å‡­æ®
   - è¿”å› JWT token
   - å‰ç«¯å­˜å‚¨ token åˆ° localStorage

2. **API è¯·æ±‚**ï¼š
   - æ¯ä¸ªç®¡ç†å‘˜ API è¯·æ±‚æºå¸¦ `Authorization: Bearer <token>` å¤´
   - Worker éªŒè¯ token æœ‰æ•ˆæ€§
   - éªŒè¯é€šè¿‡åæ‰§è¡Œæ“ä½œ

3. **Token è¿‡æœŸ**ï¼š
   - Token æœ‰æ•ˆæœŸ 7 å¤©
   - è¿‡æœŸåéœ€è¦é‡æ–°ç™»å½•

### é»˜è®¤å‡­æ®

- **ç”¨æˆ·å**ï¼š`admin`
- **å¯†ç **ï¼š`admin123`

âš ï¸ **é‡è¦**ï¼šéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒå‰åŠ¡å¿…ä¿®æ”¹ï¼

## ğŸ“Š æ•°æ®åº“è®¾è®¡

### cases è¡¨ï¼ˆæ¡ˆä¾‹ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | ä¸»é”®ï¼Œè‡ªå¢ |
| category | TEXT | åˆ†ç±»ï¼ˆcommercial, creative, etc.ï¼‰ |
| title | TEXT | æ ‡é¢˜ |
| difficulty | INTEGER | éš¾åº¦ï¼ˆ1-4ï¼‰ |
| prompt | TEXT | æç¤ºè¯å†…å®¹ |
| assets | TEXT | ç´ æè¯´æ˜ |
| tips | TEXT | ä½¿ç”¨æç¤º |
| created_at | DATETIME | åˆ›å»ºæ—¶é—´ |
| updated_at | DATETIME | æ›´æ–°æ—¶é—´ |

### case_tags è¡¨ï¼ˆæ ‡ç­¾ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | ä¸»é”®ï¼Œè‡ªå¢ |
| case_id | INTEGER | å…³è”æ¡ˆä¾‹ ID |
| tag | TEXT | æ ‡ç­¾åç§° |

### case_media è¡¨ï¼ˆåª’ä½“æ–‡ä»¶ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | ä¸»é”®ï¼Œè‡ªå¢ |
| case_id | INTEGER | å…³è”æ¡ˆä¾‹ ID |
| type | TEXT | ç±»å‹ï¼ˆimage/videoï¼‰ |
| url | TEXT | æ–‡ä»¶ URL |
| description | TEXT | æè¿° |
| order_index | INTEGER | æ’åºç´¢å¼• |
| created_at | DATETIME | åˆ›å»ºæ—¶é—´ |

## ğŸ”Œ API æ¥å£

### å…¬å¼€æ¥å£ï¼ˆæ— éœ€è®¤è¯ï¼‰

#### GET /api/cases
è·å–æ‰€æœ‰æ¡ˆä¾‹

**å‚æ•°**ï¼š
- `category` (å¯é€‰): ç­›é€‰åˆ†ç±»

**å“åº”**ï¼š
```json
[
  {
    "id": 1,
    "category": "commercial",
    "title": "åŒ…åŒ…å•†ä¸šå±•ç¤º",
    "difficulty": 2,
    "prompt": "...",
    "assets": "3å¼ å›¾ç‰‡",
    "tips": "...",
    "tags": ["äº§å“å±•ç¤º", "å¤šå›¾å‚è€ƒ"],
    "media": [
      { "type": "image", "url": "..." }
    ]
  }
]
```

#### GET /api/cases/:id
è·å–å•ä¸ªæ¡ˆä¾‹è¯¦æƒ…

### ç®¡ç†å‘˜æ¥å£ï¼ˆéœ€è¦è®¤è¯ï¼‰

#### POST /api/admin/login
ç®¡ç†å‘˜ç™»å½•

**è¯·æ±‚ä½“**ï¼š
```json
{
  "username": "admin",
  "password": "admin123"
}
```

**å“åº”**ï¼š
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

#### GET /api/admin/verify
éªŒè¯ token æœ‰æ•ˆæ€§

**Headers**ï¼š
```
Authorization: Bearer <token>
```

#### POST /api/admin/cases
åˆ›å»ºæ–°æ¡ˆä¾‹

**Headers**ï¼š
```
Authorization: Bearer <token>
Content-Type: application/json
```

**è¯·æ±‚ä½“**ï¼š
```json
{
  "category": "commercial",
  "title": "æ–°æ¡ˆä¾‹",
  "difficulty": 2,
  "prompt": "æç¤ºè¯å†…å®¹",
  "assets": "ç´ æè¯´æ˜",
  "tips": "ä½¿ç”¨æç¤º",
  "tags": ["æ ‡ç­¾1", "æ ‡ç­¾2"]
}
```

#### PUT /api/admin/cases/:id
æ›´æ–°æ¡ˆä¾‹

#### DELETE /api/admin/cases/:id
åˆ é™¤æ¡ˆä¾‹

#### POST /api/admin/upload
ä¸Šä¼ åª’ä½“æ–‡ä»¶

**Headers**ï¼š
```
Authorization: Bearer <token>
```

**è¯·æ±‚ä½“**ï¼šFormData with file

## ğŸ¨ ç®¡ç†åå°åŠŸèƒ½

### æ¡ˆä¾‹ç®¡ç†

1. **æŸ¥çœ‹æ¡ˆä¾‹åˆ—è¡¨**
   - æ˜¾ç¤ºæ‰€æœ‰æ¡ˆä¾‹
   - æŒ‰åˆ†ç±»ç­›é€‰
   - æ˜¾ç¤ºæ ‡é¢˜ã€åˆ†ç±»ã€éš¾åº¦

2. **åˆ›å»ºæ–°æ¡ˆä¾‹**
   - å¡«å†™æ¡ˆä¾‹ä¿¡æ¯
   - é€‰æ‹©åˆ†ç±»
   - è®¾ç½®éš¾åº¦
   - ç¼–å†™æç¤ºè¯
   - æ·»åŠ æ ‡ç­¾
   - ä¸Šä¼ åª’ä½“æ–‡ä»¶

3. **ç¼–è¾‘æ¡ˆä¾‹**
   - ä¿®æ”¹æ¡ˆä¾‹ä¿¡æ¯
   - æ›´æ–°æç¤ºè¯
   - ç®¡ç†æ ‡ç­¾
   - ç®¡ç†åª’ä½“æ–‡ä»¶

4. **åˆ é™¤æ¡ˆä¾‹**
   - ç¡®è®¤åˆ é™¤
   - çº§è”åˆ é™¤å…³è”æ•°æ®

### åª’ä½“ç®¡ç†

- ä¸Šä¼ å›¾ç‰‡å’Œè§†é¢‘
- é¢„è§ˆåª’ä½“æ–‡ä»¶
- åˆ é™¤åª’ä½“æ–‡ä»¶
- è‡ªåŠ¨ç”Ÿæˆ URL

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

åœ¨ `wrangler.jsonc` ä¸­é…ç½®ï¼š

```jsonc
{
  "vars": {
    "VITE_DEEPSEEK_API_KEY": "",
    "VITE_OPENROUTER1_API_KEY": ""
  },
  "d1_databases": [
    {
      "binding": "DB",
      "database_name": "prompt-agent-db",
      "database_id": "YOUR_DATABASE_ID"
    }
  ]
}
```

### JWT Secret

åœ¨ `_worker.js` ä¸­ä¿®æ”¹ï¼š

```javascript
const JWT_SECRET = 'your-secret-key-change-this-in-production'
```

å»ºè®®ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼š

```bash
wrangler secret put JWT_SECRET
```

## ğŸ“ å¼€å‘æ³¨æ„äº‹é¡¹

1. **æ•°æ®éªŒè¯**ï¼šæ‰€æœ‰ç”¨æˆ·è¾“å…¥éƒ½åº”è¯¥éªŒè¯
2. **é”™è¯¯å¤„ç†**ï¼šAPI åº”è¯¥è¿”å›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
3. **SQL æ³¨å…¥**ï¼šä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢é˜²æ­¢ SQL æ³¨å…¥
4. **XSS é˜²æŠ¤**ï¼šå‰ç«¯æ˜¾ç¤ºç”¨æˆ·è¾“å…¥æ—¶è¦è½¬ä¹‰
5. **CORS**ï¼šæ­£ç¡®é…ç½® CORS å¤´
6. **æ€§èƒ½ä¼˜åŒ–**ï¼šåˆç†ä½¿ç”¨ç´¢å¼•ï¼Œé¿å… N+1 æŸ¥è¯¢

## ğŸ› å¸¸è§é—®é¢˜

### Q: æ•°æ®åº“è¿æ¥å¤±è´¥
A: æ£€æŸ¥ `wrangler.jsonc` ä¸­çš„ database_id æ˜¯å¦æ­£ç¡®

### Q: ç™»å½•å¤±è´¥
A: ç¡®è®¤ç”¨æˆ·åå¯†ç æ­£ç¡®ï¼Œæ£€æŸ¥ JWT Secret é…ç½®

### Q: æ–‡ä»¶ä¸Šä¼ å¤±è´¥
A: éœ€è¦é…ç½® R2 å­˜å‚¨æ¡¶ï¼Œå‚è€ƒ ADMIN_SETUP.md

### Q: API è¿”å› 401
A: Token å¯èƒ½å·²è¿‡æœŸï¼Œéœ€è¦é‡æ–°ç™»å½•

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ADMIN_SETUP.md](./ADMIN_SETUP.md) - è¯¦ç»†éƒ¨ç½²æŒ‡å—
- [Cloudflare D1 æ–‡æ¡£](https://developers.cloudflare.com/d1/)
- [Cloudflare Workers æ–‡æ¡£](https://developers.cloudflare.com/workers/)

